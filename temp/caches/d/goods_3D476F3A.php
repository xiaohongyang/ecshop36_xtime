<?php exit;?>a:3:{s:8:"template";a:5:{i:0;s:51:"D:/clientweb/Xtime/wwwroot/themes/default/goods.dwt";i:1;s:65:"D:/clientweb/Xtime/wwwroot/themes/default/library/page_header.lbi";i:2;s:67:"D:/clientweb/Xtime/wwwroot/themes/default/library/goods_gallery.lbi";i:3;s:62:"D:/clientweb/Xtime/wwwroot/themes/default/library/add_cart.lbi";i:4;s:65:"D:/clientweb/Xtime/wwwroot/themes/default/library/page_footer.lbi";}s:7:"expires";i:1503582471;s:8:"maketime";i:1503578871;}<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="Keywords" content="" />
  <meta name="Description" content="" />
  
  <title>手机商品5</title>
  
  <link href="themes/default/style.css" rel="stylesheet" type="text/css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="/themes/default/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="/themes/default/css/font-awesome.min.css"/>
  <link rel="stylesheet" href="/themes/default/css/dialog.min.css"/>
    <link rel="stylesheet" href="/themes/default/css/slider.css"/>
  <link rel="stylesheet" href="/themes/default/css/new.css"/>
  <script src="/js/jquery.min.js"></script>
      <script src="/js/jquery.touchSwipe.min.js"></script>
    <script src="/js/jquery.dialog.min.js"></script>
    <script src="/js/jquery.slider.min.js"></script>
    <script src="/themes/default/js/main.js"></script>
</head>
<body><div class="x-around">
    <div class="x-head" style="background:#FEFFFF">
        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <div class="x-headjt" onclick="javascrpt:window.location.href='/'">
                <img src="themes/default/img/jt.png" alt="">
            </div>
            <div class="x-headax x-headaxhui addCollect" data-goods="5">
            </div>
            <div class="goods-gallery">
                <div class="slider">
       <div class="slider-box">
           <ul>
                          <li><a href="images/201704/thumb_img/5_thumb_P_1493176957860.jpg"><img src="images/201704/thumb_img/5_thumb_P_1493176957860.jpg" width="100%" alt=""></a></li>
                              <li><a href="images/201705/thumb_img/5_thumb_P_1495089400764.jpg"><img src="images/201705/thumb_img/5_thumb_P_1495089400764.jpg" width="100%" alt=""></a></li>
                              <li><a href="images/201705/thumb_img/5_thumb_P_1495451621190.jpg"><img src="images/201705/thumb_img/5_thumb_P_1495451621190.jpg" width="100%" alt=""></a></li>
                          </ul>
       </div>
   </div>
   <script>
       $(document).ready(function() {
           var silder = $(".slider").slider({
               width: 1,
               height: 1,
               auto: !1
           });
           $(".slider a").click(function (e) { 
               e.preventDefault();
               Dialog.create({
                   type: 'box',
                   title: '',
                   content: '<img src="' + $(this).attr('href') + '">',
                   hasYes: false,
                   hasNo: false
                }).show();
            });
       });
   </script>            </div>
            <div class="x-shopname">
                <span>手机商品5                    <span class="x-shopcolor"></span>
                </span>
            </div>
            <div class="x-shopother">
                <div class="x-left">
                    <span></span>
                    <span>售出：1</span>
                     <span class="cpadding-left">
                                                                        <em>商品库存：</em> <font color='red'>缺货</font>
                                                                    </span>
                </div>
               
            </div>
            <div class="x-shopprice">
                <span class="x-shopuser">会员价：<em class="x-xinghuibi">300</em>.00星辉币</span>
                <span class="x-shopoprice">原价：360.00</span>
            </div>
            <div class="x-shopzk">
                            </div>
        </div>
        <div class="x-main">
                        <div class="x-gouxuan">
                <div class="x-gxshop addCart" data-id="5" data-for=".selected-attr">
                    <div class="x-left " >
                        <span class="x-gxyx">已选</span>
                        <span class="selected-attr"></span>
                    </div>
                    <div class="x-right">
                        <img src="themes/default/img/yjt.png" alt="">
                    </div>
                </div>
            </div>
            <div class="x-shopproduce">
                <h4>商品简介</h4>
                <div class="x-produdename">
                                    </div>
            </div>
            <div class="x-hotsale">
                <div class="x-hothead">
                    <div class="x-graytext">
                        <span class="x-graylayout">
                        <span class="x-grayimg">近期热卖</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="content" style="margin-bottom:80px">
            45ea207d7a2b68c49582d2d22adf953asales|a:1:{s:4:"name";s:5:"sales";}45ea207d7a2b68c49582d2d22adf953a        </div>
        <div class="x-footer row x-row">
            <div class="col-xs-2 x-paddr" onclick="javascrtpt:window.location.href='flow.php'">
                <img src="themes/default/img/shopcar.png" alt="">
                <span class="x-cshop">购物车</span>
                <span class="x-number">45ea207d7a2b68c49582d2d22adf953acart_info|a:1:{s:4:"name";s:9:"cart_info";}45ea207d7a2b68c49582d2d22adf953a</span>
            </div>
            <div class="col-xs-5 x-addshop">
                <a href="javascript:;" class="addCart" data-id="5" data-for=".selected-attr">加入购物车</a>
            </div>
            <div class="col-xs-5 x-addbuy">
                <a href="javascript:;" class="addCart" data-id="5" data-buy="true" data-for=".selected-attr">立即购买</a>
            </div>
        </div>
    </div>
    <div class="mengbannn cartGoods">
  <div class="modal-content">
    <div class="xqmtk">
    <p style="width:7%;float:right;"> <button type="button" class="close user-dealDone-close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></p>
       <div class="bang" style="width:93%;float:left">
         <dl>
             <dt><img class="thumb" src="img/23.png"></dt>
             <dd><a href="#"><span class="zi price">0</span><b class="title"></b></a></dd>
             <dd><a href="#">库存<b class='stock'></b>件</a></dd>
             <dd class="selectedSpecBox"><a href="#"><span class="huise">已选:</span><em class="selected-spec"></em></a></dd>
         </dl>
      </div>
      <div style="clear:both">
          <div class="heiauto spec">
          </div>
      <h4 class="number-group"><span>购买数量</span><input type="button" value="+" class="jia number-plus">
      <input type="text" value="1" class="txt number">
      <input type="button" value="-" class="jian no number-minus"></h4>
      <input type="button" value="加入购物车" class="kucun">
    </div>
  </div>
</div>
</div>
<script>
    $(document).ready(function() {
        var goods_id = 0;
        var is_buy = false;
        var showAttrEle = null;
        var sku = 1;
        var showGoods = function(goods) {
            $(".cartGoods .thumb").attr("src", goods.goods_thumb);
            //$(".cartGoods .title").html(goods.goods_name);
            $(".cartGoods .price").html(goods.shop_price);
            sku = goods.goods_number;
             $(".cartGoods .stock").html(sku);
            var html = '';
            $.each(goods.properties, function(i, item) {
                var h = '';
                $.each(item.values, function(j, val) {
                    h += '<span data-id="'+ val.id +'" data-price="'+val.price+'">' + val.label +'</span>';
                });
                html += '<div class="spec-item"><h4>' + item.name
                +'</h4><div class="fla">' + h+'</div></div>';
            });
            $(".cartGoods .selectedSpecBox").hide();
            $(".cartGoods .spec").html(html);
            $(".cartGoods .number").val(1);
            $(".cartGoods .number-minus").addClass('disable');
            if (sku < 2) {
                $(".cartGoods .number-plus").addClass('disable');
            } else {
                $(".cartGoods .number-plus").removeClass('disable');
            }
            $(".cartGoods .selected-spec").text();
            $(".cartGoods").toggle();
            $(".cartGoods .kucun").val(is_buy ? '立即购买' : '加入购物车');
        }
        $(".addCart").click(function() {
            goods_id = $(this).attr("data-id");
            is_buy = $(this).attr('data-buy');
            showAttrEle = $(this).attr('data-for');
            $.getJSON("goods.php?act=buy&id=" + goods_id, function(data) {
                if (data.code == 0) {
                    showGoods(data.data);
                    return;
                }
                Dialog.tip(data.msg);
            });
        });
        var getSelectedAttr = function() {
            var data = [];
            var attr = '';
            $(".cartGoods .spec span.current").each(function(i, item) {
                 data.push($(item).attr('data-id'));
                 attr += ',' + $(item).text();
            });
            attr = attr.substr(1);
            $(".cartGoods .selected-spec").text(attr);
            showAttrEle && $(showAttrEle).text(attr);
            return data;
        };
         $(".cartGoods .spec").on("click", "span", function() {
             $(".cartGoods .selectedSpecBox").show();
            var $this = $(this);
            $this.addClass("current").siblings().removeClass("current");
            var attr = getSelectedAttr();
            var qty = $('.cartGoods .number-group .number').val();
            $.getJSON('goods.php?act=price&id=' + goods_id +'&attr=' +
            attr.join(',') + '&number=' + qty, function (data) {
                if (data.err_msg == '') {
                    $(".cartGoods .price").html(data.result);
                    return;
                }
                Dialog.tip(data.err_msg);
            });
        });
        $(".cartGoods .kucun").click(function() {
            var num = parseInt($(".cartGoods .number").val());
            var spec;
            var hasError = false;
            $(".cartGoods .spec .spec-item").each(function(i, el) {
                var ele = $(el).find(".current");
                if (ele.length < 1) {
                    hasError = true;
                    return false;
                }
                if (!spec) {
                    spec = ele.attr("data-id");
                    return;
                }
                spec += "," + ele.attr("data-id");
            });
            if (hasError) {
                Dialog.tip("请选择规格！");
                return;
            }
            var isBuy = $(this).val() == '立即购买';
            $(".cartGoods").hide();
            $.getJSON("flow.php?step=add_goods&goods_id=" + goods_id + "&num=" + num + "&spec="+ spec, function(data) {
                if (data.code == 0) {
                    if (isBuy) {
                        window.location.href = "flow.php?step=checkout&cart_value=" + data.data;
                        return;
                    }
                    data.msg = '添加成功！';
                    $('.x-footer .x-number').text(parseInt($('.x-footer .x-number').text()) + num);
                }
                Dialog.tip(data.msg);
            });
        });
        $(".cartGoods .number-minus").click(function() {
            var num = parseInt($(".cartGoods .number").val());
            num --;
            if (num < 1) {
                num = 1;
            }
            if (num < 2) {
                $(".cartGoods .number-minus").addClass('disable');
            }
            $(".cartGoods .number").val(num);
            if (num < sku) {
                $(".cartGoods .number-plus").removeClass('disable');
            }
        });
        $(".cartGoods .number").blur(function() {
            var num = parseInt($(".cartGoods .number").val());
            if (num > sku) {
                num = sku;
                Dialog.tip('输入的数量超过了库存数');
            }
            if (num < 1) {
                num = 1;
            }
            $(".cartGoods .number").val(num);
            if (num >= sku) {
                $(".cartGoods .number-plus").addClass('disable');
            } else {
                $(".cartGoods .number-plus").removeClass('disable');
            }
            if (num <= 1) {
                $(".cartGoods .number-minus").addClass('disable');
            } else {
                $(".cartGoods .number-minus").removeClass('disable');
            }
        });
        $(".cartGoods .number-plus").click(function() {
            var num = parseInt($(".cartGoods .number").val());
            num ++;
            if (num > sku) {
                Dialog.tip('不能再添加数量了哦');
                return;
            }
            $(".cartGoods .number-minus").removeClass('disable');
            $(".cartGoods .number").val(num);
            if (num >= sku) {
                $(".cartGoods .number-plus").addClass('disable');
            }
        });
        $(".cartGoods .close").click(function() {
            $(".cartGoods").hide();
        });
    });
</script><script>
    $(document).ready(function () {
        $(".addCollect").click(function () {
            var ele = $(this);
            $.getJSON('user.php?act=collect&id=' + ele.attr('data-goods'), function (data) {
                if (data.code == 0) {
                    Dialog.tip(data.data);
                    ele.removeClass('x-headaxhui');
                    return;
                }
                Dialog.tip(data.msg);
            });
        });
        $.getJSON('user.php?act=has_collect&id=5', function (data) {
            if (data.code == 0) {
                $(".addCollect").removeClass('x-headaxhui');
            }
        });
    });
</script>
        </body>
</html>